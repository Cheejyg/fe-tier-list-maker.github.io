<!doctype html>
<html>
<head>
	<link rel="icon" type="image/x-icon" href= "../icon.png"/>
	<title>Fire Emblem Venn Diagram Maker</title>
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,100italic" rel="stylesheet" type="text/css">
	<link href="../newstyle.css" rel="stylesheet">
	<link href="venn.css" rel="stylesheet">
	<meta name="google-site-verification" content="mhlxk9_OOcyed8If_JjdkOZv6GmGPYfSnbsafwWmRC4" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:creator" content="@e5e_ebooks" />
	<meta property='og:image' content='https://fe-tier-list-maker.github.io/preview_image.png'/>
	<meta property='og:url' content='https://fe-tier-list-maker.github.io/'/>
	<meta property='og:title' content='FE Tier List Maker'/>
	<meta property='og:description' content='Everyone is here!' />
	<meta name="keywords" content="Fire Emblem,Tier List,Three Houses,FE,Awakening,Fates">
	<meta name="viewport" content="user-scalable=no">
	<meta charset="UTF-8"> 
</head>
<body>
	<div id="controls">
		<h1 style="padding-left: 8px;"><span>neat</span> DIAGRAM MAKER</h1>
		<div id="buttons">
			<button id="characters">Change characters</button>
			<button id="screenshot">Screenshot</button>
			<button id="help">Help</button>
			<button id="options">Options</button>
			<button id="reset">Reset</button>
		</div>
	</div>
	
	<div id="tablewrap">
		<div class='labelHolder' style='left:40vw;'>
			<div class='handle'></div>
			<span class='label' contenteditable='true'>Left</span>
		</div>
		<div class='labelHolder' style='left:50vw;'>
			<div class='handle'></div>
			<span class='label' contenteditable='true' >Middle</span>
		</div>
		<div class='labelHolder' style='left:60vw;'>
			<div class='handle'></div>
			<span class='label' contenteditable='true'>Right</span>
		</div>
		<div id="tablemain"></div>
	</div>
	
	<div id="char" class="sort">
		<div>If no characters are loaded here, choose a game by clicking the "Change game" button above.</div>
	</div>
	
	<div id="overlay" data-html2canvas-ignore="true">
		<div id="modalWrapper">
			<div id="modal" class="popupMenu">
				<h1>OPTIONS</h1>
				<span id="close"></span>
				<p>Choose background color:</p>
				<div id="colorselect"><span style="background:#FF7F7F"></span><span style="background:#FFBF7F"></span><span style="background:#FFDF7F"></span><span style="background:#FFFF7F"></span><span style="background:#BFFF7F"></span><span style="background:#7FFF7F"></span><span style="background:#7FFFFF"></span><span style="background:#7FBFFF"></span><span style="background:#7F7FFF"></span><span style="background:#FF7FFF"></span><span style="background:#BF7FBF"></span><span style="background:#1A1A1A"></span><span style="background:#858585"></span><span style="background:#CFCFCF"></span><span style="background:#FFFFFF"></span></div>
			</div>
			<div id="charChange" class="popupMenu">
				<h1>CHANGE CHARACTERS</h1>
				<span id="close"></span>
				<div id="checklist"><div></div></div>
				<p><strong>Hiding a game will remove every character from that game from your tierlist!</strong> Do not click unless you are sure you want to change! You cannot undo this.</p>
			</div>
			<div id="helpMenu" class="popupMenu">
				<h1>HELP</h1>
				<span id="close"></span>
				<!-- <p>This is like a Smash Tier List Maker, but with Fire Emblem instead.</p> !-->
				<p>Source code can be found <a href ="https://github.com/fe-tier-list-maker/fe-tier-list-maker.github.io">here</a> and was forked from <a href ="https://github.com/quetzle/smash-apps">here</a>.</p>
				<p>Information on image ownership can be found <a href = "https://github.com/fe-tier-list-maker/fe-tier-list-maker.github.io/blob/master/CREDITS.md">here</a>.</p>
				<p>You can click and drag characters into the list or double-click to instantly move them to the highest tier.</p>
				<p>Clicking on the "Dock tier list" button will <strong>stick the tier list to the top of the window.</strong>
				This can be useful if you have a large number of characters on-screen and don't want to scroll up and down
				as you drag them into your list. Clicking the button again will return the list to its original position.</p>
				<!--  <p><strong>To take a screenshot,</strong> you can click the "Hide controls" button to make the list look cleaner. Then, use a screenshot tool such as Snipping Tool on Windows to take a screenshot.</p> !-->
				<p>There is a gear next to each tier in the tierlist. If you click on it, you can <strong>change the color of the tier label, add rows, delete the row, or remove all of the characters currently in the row.</strong></p>
				<p>Next to the gear are two arrows which will let you <strong>move a tier up and down a level</strong>.</p>
				<p><strong>You can change the name of the tier</strong> by clicking on the tier label and typing in there. If this doesn't work, you can change or reset it in the tier's settings menu (the gear).</p>
				<p>If you want to <strong>completely start over</strong>, refresh the page or click the "Reset" button at the top of the page.</a>
				<p>For any issues, add it to the list on the repository page or message me on <a href ="https://twitter.com/e5e_ebooks">Twitter</a> or elsewhere.</p>
			</div>
			<div id="screenshotShow" class="popupMenu">
				<h1>SCREENSHOT</h1>
				<span id="close"></span>
				<p style="text-align: left;">Your image should appear above. You can copy or save this image.</p>
			</div>
		</div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
	<script src="../draggabilly.pkgd.min.js"></script>
	<script src="../html2canvas.min.js"></script>
	<script src="../common.js"></script>
	<script>
		var colors = ["#FF7F7F","#FFBF7F","#FFDF7F","#FFFF7F","#BFFF7F","#7FFF7F","#7FFFFF","#7FBFFF","#7F7FFF","#FF7FFF","#BF7FBF","#1A1A1A","#858585","#CFCFCF","#FFFFFF"];
		var currentColor;
		var colorIndex;
		var $draggable;

		$(document).on("click", "#colorselect span", function() { // change row label
			for (var i = 0; i < $("#modal span").length; i++) {
				$("#modal span:nth-of-type("+(i+1)+")").attr("class","nope");
			}
			$(this).attr("class","selected");
			$("#tablewrap").css("background-color", $(this).css("background-color"));
		});

		$(document).on("click", "#screenshot", function() { // open save/load modal
			openPopup("#screenshotShow");
		});

		$(document).on("click", "#options", function() { // open options modal
			currentColor = $("#tablewrap").css("background-color");
			colorIndex = colors.indexOf(rgb2hex(currentColor).toUpperCase());
			for (var i = 0; i < $("#modal span").length; i++) {
				$("#modal span:nth-of-type("+(i+1)+")").attr("class","nope");
			}
			$("#modal span:nth-of-type("+(colorIndex+1)+")").attr("class","selected");
			openPopup("#modal");
		});
		
		$(document).on("change", ".characterCheck", function() { // add/remove characters
			gameId = ($(this).attr("id"));
			gameClass = ($(this).attr("class"));
			// remove non-numeric characters - stackoverflow.com/questions/1862130/
			gameIndex = gameClass.replace(/\D/g,'');
			// alternative 
			// gameInfo = currentGameChars.find(function(curr) { return curr[0] == gameId;});
			
			if($(this).is(":checked")) {
				for (var k = 0; k <= currentGameChars[gameIndex][1]; k++) {
					$("#char div:last-child").after(singleChar);
					$("#char div:last-child").css("background-image","url(../img/"+currentGame+"/"+gameId+"/"+k+".png)");
					$("#char div:last-child").attr("id", gameId + "-" + k);
					// $("#char div:last-child").attr("title", allCharacters[gameIndex][k]);
				}
			} else {
				$(".character[id^="+currentGameChars[gameIndex][0]+"]").each( function() {
					$(this).remove();
				});
			}
			$draggable = $('.character').draggabilly();
		});
		
		$(document).on("dragStart", '.character', function() { // attach to diagram
			// $(this).detach().appendTo('#tablewrap');
			// $(this).css("position", "absolute");
		});
			
		$(document).on("click", function(e) {
			clicked = e.target.id;
			if(clicked == "overlay" || clicked == "modalWrapper" || clicked == "close") { // close modals
				closePopups();
				$("#screenshotShow").css("display", "none");
				$("#overlay").css("opacity", 0);
				$("#overlay").css("visibility", "hidden");
			} else if(clicked == "screenshot") { // take a screenshot
				closePopups();
				$("#screenshotShow").css("display","block");
				$("#overlay").css("opacity", 1);
				$("#overlay").css("visibility", "visible");
				// $("#tablemain").css("margin", "3px");
				// $("#tablemain").css("max-width", "100%");
				window.scrollTo(0,0);
				html2canvas(document.body, {
					width: $("#tablemain").width(),
					height: $("#tablemain").height(),
					x: Math.round($("#tablemain").offset().left),
					y: Math.round($("#tablemain").offset().top),
				}).then(function(canvas) {
					$("#screenshotShow span").after(canvas);
					$("#screenshotShow canvas").css("max-width", "70%");
					$("#screenshotShow canvas").css("height", "auto");
					$("#screenshotShow").css("top",alignPopup($("#screenshotShow")));
					$("#tablemain").removeAttr('style');
				});
			} else if (clicked == "reset") {
				changeGame(currentGameChars);
			} 
		});
		
		function changeGame(game) {
			currentGameChars = [];
			currentGameChars = game;
			currentGame = game[0][0];
			$(".character").each( function() {
				$(this).remove();
			});
			$(".characterCheckWrap").each( function() {
				$(this).remove();
			});
			// just in case there's more than one...
			$(".selectAllWrap").each( function() {
				$(this).remove();
			});
			
			for (var i = 1; i < game.length; i++) {
				/*
				for (var k = 0; k <= game[i][1]; k++) {
					$("#char div:last-child").after(singleChar);
					$("#char div:last-child").css("background-image","url(../img/"+currentGame+"/"+game[i][0]+"/"+k+".png)");
					$("#char div:last-child").attr("id",i);
				}
				*/
				
				$("#checklist div:last-child").after(singleCheckWrap);
				$("#checklist div:last-child").html(game[i][2]+": <input type='checkbox' class='characterCheck "+"game"+i+"' id='"+game[i][0]+"' >");
			}
			$("#checklist div:last-child").after(selectAllWrap);
			$("#checklist div:last-child").html("Select All: <input type='checkbox' class='selectAll' id='all' >");
			
			$( ".characterCheck.game29" ).prop('checked', true).change();

			$("h1 span").text(currentGame);
		}
		
		$(document).ready( function() {
			$("#char").html("<div></div>");
			changeGame(gameFe);
			$draggable = $('.labelHolder').draggabilly({ handle: '.handle' });
		});
	</script>
</body>
